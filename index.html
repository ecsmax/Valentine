<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Valentine üíò</title>

  <style>
    :root{
      --bg1:#fff1f6;
      --bg2:#ffe4ec;
      --cream:#fff7ee;
      --pink:#ff5fa2;
      --text:#4a2b33;

      /* spacing rules */
      --edge-pad: 16px;                  /* 12‚Äì16px */
      --gap-min: 24px;                   /* min distance to YES */
      --bottom-toolbar-fallback: 72px;   /* extra safety for iOS Safari */

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-rounded, "SF Pro Rounded", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 20% 10%, var(--cream), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, #ffe0ea, transparent 55%),
        radial-gradient(800px 600px at 50% 90%, #ffeef4, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    /* floating background hearts */
    .hearts-bg{ position:fixed; inset:0; pointer-events:none; overflow:hidden; opacity:.55; z-index:1; }
    .heart{
      position:absolute; width:14px; height:14px;
      transform: rotate(45deg);
      animation: floatUp linear infinite;
      opacity:0;
      background: rgba(255, 95, 162, .26);
      border-radius: 3px;
    }
    .heart::before, .heart::after{
      content:""; position:absolute; width:14px; height:14px;
      background: rgba(255, 95, 162, .26);
      border-radius:50%;
    }
    .heart::before{ left:-7px; top:0; }
    .heart::after{ left:0; top:-7px; }
    @keyframes floatUp{
      0%{ transform: translate3d(0, 40px, 0) rotate(45deg) scale(.9); opacity:0; }
      12%{ opacity:.55; }
      60%{ opacity:.30; }
      100%{ transform: translate3d(0, -120vh, 0) rotate(45deg) scale(1.25); opacity:0; }
    }

    /* main card */
    .wrap{
      position:relative;
      height:100%;
      padding:
        calc(18px + var(--safe-top))
        calc(18px + var(--safe-right))
        calc(18px + var(--safe-bottom))
        calc(18px + var(--safe-left));
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
    }
    .card{
      width:min(520px, 100%);
      padding:22px 18px 18px;
      border-radius:22px;
      background: rgba(255,255,255,.56);
      border: 1px solid rgba(255,255,255,.65);
      box-shadow: 0 18px 60px rgba(255, 59, 106, .12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-align:center;
    }
    h1{
      margin:8px 8px 12px;
      font-size: clamp(26px, 6.3vw, 40px);
      line-height:1.08;
      letter-spacing:-.02em;
    }
    .sub{ margin:0 8px 14px; font-size:14px; opacity:.75; }

    .btn-row{
      position:relative;
      display:flex;
      justify-content:center;
      gap:14px;
      padding: 10px 0 6px;
      min-height: 86px;
    }

    button{
      appearance:none; border:none;
      border-radius:18px;
      padding:16px 18px;
      min-width: 140px;
      font-size:18px;
      font-weight:700;
      letter-spacing:.01em;
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
      transform: translateZ(0);
      will-change: transform;
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
    }
    .yes{
      background: linear-gradient(180deg, #ff7ab7, var(--pink));
      color:white;
    }
    .yes:active{ transform: translateY(1px) scale(.99); }

    /* NO button: always present, always flees */
    .no{
      position:fixed; left:0; top:0;
      background: linear-gradient(180deg, #ffe9f1, #ffd7e6);
      color:#7a2b3e;
      border: 1px solid rgba(255, 95, 162, .22);
      box-shadow: 0 10px 25px rgba(255, 59, 106, .12);
      transition: transform 240ms cubic-bezier(.12,.82,.2,1);
      z-index: 20;
    }

    .tiny{ margin-top:10px; font-size:12px; opacity:.55; }

    /* tiny heart burst (optional extra) */
    .burst-layer{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:30; }
    .burst{
      position:absolute;
      font-size: 18px;
      animation: burstFly 900ms ease-out forwards;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.10));
      opacity:0;
    }
    @keyframes burstFly{
      0%{ transform: translate3d(0,0,0) scale(.7); opacity:0; }
      10%{ opacity:1; }
      100%{ transform: translate3d(var(--dx), var(--dy), 0) rotate(var(--rot)) scale(1.25); opacity:0; }
    }

    /* GIF overlay with fly-towards animation */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:
        calc(14px + var(--safe-top))
        calc(14px + var(--safe-right))
        calc(14px + var(--safe-bottom))
        calc(14px + var(--safe-left));
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      z-index: 40;
      perspective: 900px;
      transform-style: preserve-3d;
    }
    .overlay.show{ display:flex; }

    .overlay-card{
      width:min(680px, 96vw);
      border-radius:22px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(255,255,255,.78);
      box-shadow: 0 22px 80px rgba(0,0,0,.22);
      overflow:hidden;
      transform: translate3d(0, 18px, -140px) scale(.56) rotateX(10deg);
      opacity:0;
    }
    .overlay-card.fly-in{
      animation: flyIn 520ms cubic-bezier(.10,.92,.18,1) forwards;
    }
    @keyframes flyIn{
      0%{ transform: translate3d(0, 18px, -140px) scale(.56) rotateX(10deg); opacity:0; }
      45%{ opacity:1; }
      100%{ transform: translate3d(0, 0, 0) scale(1) rotateX(0deg); opacity:1; }
    }

    .gif{ width:100%; max-height: 62vh; object-fit: cover; display:block; }

    .overlay-body{ padding:14px 16px 16px; text-align:center; }
    .overlay-title{ margin:6px 0 8px; font-size:18px; font-weight:800; }
    .overlay-text{ opacity:.75; font-size:14px; }
    .overlay-actions{ display:flex; justify-content:center; margin-top:10px; }
    .close{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255, 95, 162, .22);
      color:#7a2b3e;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      min-width: 180px;
    }
    .close:active{ transform: translateY(1px) scale(.99); }
  </style>
</head>

<body>
  <div class="hearts-bg" aria-hidden="true" id="heartsBg"></div>
  <div class="burst-layer" aria-hidden="true" id="burstLayer"></div>

  <main class="wrap">
    <section class="card">
      <h1 id="question">Will you be my Valentine?</h1>
      <p class="sub" id="sub">Be honest. I can take it. (Probably.)</p>

      <div class="btn-row" id="btnRow">
        <button class="yes" id="yesBtn">üíï Yes</button>
        <button class="no" id="noBtn" aria-disabled="true">üíî No</button>
      </div>

      <div class="tiny">Tip: try to press ‚ÄúNo‚Äù. üòà</div>
    </section>
  </main>

  <!-- GIF overlay -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="overlay-card" id="overlayCard">
      <img class="gif" id="loveGif" alt="Funny love gif" />
      <div class="overlay-body">
        <div class="overlay-title" id="overlayTitle">Yay! ‚ù§Ô∏è I knew it!</div>
        <div class="overlay-text" id="overlayText">Now come here. ü•π</div>
        <div class="overlay-actions">
          <button class="close" id="closeBtn">Okay üíò</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mini pop sound (base64 WAV, no external files) -->
  <audio id="popSound" preload="auto">
    <source type="audio/wav" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" />
  </audio>

  <script>
    (() => {
      const heartsBg   = document.getElementById('heartsBg');
      const burstLayer = document.getElementById('burstLayer');
      const yesBtn     = document.getElementById('yesBtn');
      const noBtn      = document.getElementById('noBtn');
      const question   = document.getElementById('question');
      const sub        = document.getElementById('sub');
      const btnRow     = document.getElementById('btnRow');

      const overlay    = document.getElementById('overlay');
      const overlayCard= document.getElementById('overlayCard');
      const closeBtn   = document.getElementById('closeBtn');
      const loveGif    = document.getElementById('loveGif');
      const popSound   = document.getElementById('popSound');

      // 4 GIF options (random each Yes click)
      const GIFS = [
        "https://media.giphy.com/media/MDJ9IbxxvDUQM/giphy.gif",
        "https://media.giphy.com/media/3ohzdIuqJoo8QdKlnW/giphy.gif",
        "https://media.giphy.com/media/l0HlBO7eyXzSZkJri/giphy.gif",
        "https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif"
      ];

      // --- Background hearts ---
      const HEARTS = 18;
      function spawnBgHearts(){
        heartsBg.innerHTML = '';
        const vw = Math.max(320, window.innerWidth);
        for(let i=0;i<HEARTS;i++){
          const h = document.createElement('div');
          h.className = 'heart';
          const left  = Math.random() * vw;
          const delay = Math.random() * 6;
          const dur   = 6 + Math.random() * 8;
          const scale = 0.7 + Math.random() * 1.1;
          const alpha = 0.18 + Math.random() * 0.25;

          h.style.left = `${left}px`;
          h.style.bottom = `${-40 - Math.random()*120}px`;
          h.style.animationDelay = `${delay}s`;
          h.style.animationDuration = `${dur}s`;
          h.style.transform = `rotate(45deg) scale(${scale})`;
          h.style.background = `rgba(255, 95, 162, ${alpha})`;
          heartsBg.appendChild(h);
        }
      }

      // --- Visible viewport box for iOS Safari (uses visualViewport) ---
      function getViewportBox(){
        const pad =  parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--edge-pad')) || 16;
        const fallbackBottom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--bottom-toolbar-fallback')) || 72;

        const vv = window.visualViewport;
        let left = pad, top = pad, right, bottom;

        if (vv) {
          left   = pad + (vv.offsetLeft || 0);
          top    = pad + (vv.offsetTop  || 0);
          right  = (vv.width  + (vv.offsetLeft || 0)) - pad;
          bottom = (vv.height + (vv.offsetTop  || 0)) - pad;
        } else {
          right  = window.innerWidth - pad;
          bottom = (window.innerHeight - fallbackBottom) - pad;
        }

        // Safe area insets
        left   += parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-left')) || 0;
        top    += parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-top')) || 0;
        right  -= parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-right')) || 0;
        bottom -= (parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-bottom')) || 0);

        // Extra bottom cushion so NO never sits under Safari bar
        bottom -= 16;

        return { left, top, right, bottom, width: right-left, height: bottom-top };
      }

      // --- NO button flee logic ---
      let noW = 0, noH = 0;
      let posX = 0, posY = 0;
      let ticking = false;

      function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }
      function rectFromXY(x, y, w, h){ return { left:x, top:y, right:x+w, bottom:y+h, width:w, height:h }; }

      function getYesRect(){
        const r = yesBtn.getBoundingClientRect();
        return { left:r.left, top:r.top, right:r.right, bottom:r.bottom, width:r.width, height:r.height };
      }

      function distanceToRect(px, py, rect){
        const dx = Math.max(rect.left - px, 0, px - rect.right);
        const dy = Math.max(rect.top - py, 0, py - rect.bottom);
        return Math.hypot(dx, dy);
      }

      function tooCloseToYes(candidate){
        const yes = getYesRect();
        const gap = 24;
        const inflated = {
          left: yes.left - gap,
          top: yes.top - gap,
          right: yes.right + gap,
          bottom: yes.bottom + gap
        };
        return (
          candidate.left < inflated.right &&
          candidate.right > inflated.left &&
          candidate.top < inflated.bottom &&
          candidate.bottom > inflated.top
        );
      }

      function withinVisible(candidate){
        const box = getViewportBox();
        const minX = box.left;
        const minY = box.top;
        const maxX = box.right - candidate.width;
        const maxY = box.bottom - candidate.height;
        return (candidate.left >= minX && candidate.top >= minY && candidate.left <= maxX && candidate.top <= maxY);
      }

      function applyNoPosition(x, y){
        posX = x; posY = y;
        noBtn.style.transform = `translate3d(${Math.round(x)}px, ${Math.round(y)}px, 0)`;
      }

      function measureNo(){
        const r = noBtn.getBoundingClientRect();
        noW = r.width; noH = r.height;
      }

      function placeNoInitial(){
        measureNo();
        const box = getViewportBox();
        const rowRect = btnRow.getBoundingClientRect();

        let x = clamp((box.left + box.width/2) + 40, box.left, box.right - noW);
        let y = clamp(rowRect.top + 6, box.top, box.bottom - noH);

        let cand = rectFromXY(x, y, noW, noH);
        if(tooCloseToYes(cand)){
          x = clamp((box.left + box.width/2) + 140, box.left, box.right - noW);
          cand = rectFromXY(x, y, noW, noH);
          if(tooCloseToYes(cand)){
            y = clamp(rowRect.top + 80, box.top, box.bottom - noH);
          }
        }
        x = clamp(x, box.left, box.right - noW);
        y = clamp(y, box.top,  box.bottom - noH);
        applyNoPosition(x, y);
      }

      function chooseCandidate(px, py){
        const box = getViewportBox();
        const minX = box.left;
        const minY = box.top;
        const maxX = box.right - noW;
        const maxY = box.bottom - noH;

        const cx = posX + noW/2;
        const cy = posY + noH/2;

        // Move away from pointer + jitter
        const vx = cx - px, vy = cy - py;
        const baseAngle = Math.atan2(vy, vx);
        const jitter = (Math.random() * 0.9 - 0.45);
        const angle = baseAngle + jitter;

        const dist = 80 + Math.random() * 60; // 80‚Äì140
        let x = posX + Math.cos(angle) * dist;
        let y = posY + Math.sin(angle) * dist;

        // occasional random hop
        if(Math.random() < 0.22){
          x = minX + Math.random() * (maxX - minX);
          y = minY + Math.random() * (maxY - minY);
        }

        x = clamp(x, minX, maxX);
        y = clamp(y, minY, maxY);
        return { x, y };
      }

      function moveNoAway(px, py){
        const attempts = 60;
        for(let i=0;i<attempts;i++){
          const { x, y } = chooseCandidate(px, py);
          const cand = rectFromXY(x, y, noW, noH);
          if(!withinVisible(cand)) continue;
          if(tooCloseToYes(cand)) continue;
          if(Math.hypot(x - posX, y - posY) < 28) continue;
          applyNoPosition(x, y);
          return;
        }
        // fallback: farthest corner from YES
        const yes = getYesRect();
        const box = getViewportBox();
        const corners = [
          { x: box.left, y: box.top },
          { x: box.right - noW, y: box.top },
          { x: box.left, y: box.bottom - noH },
          { x: box.right - noW, y: box.bottom - noH }
        ];
        corners.sort((a,b) => {
          const da = Math.hypot((a.x+noW/2)-(yes.left+yes.width/2),(a.y+noH/2)-(yes.top+yes.height/2));
          const db = Math.hypot((b.x+noW/2)-(yes.left+yes.width/2),(b.y+noH/2)-(yes.top+yes.height/2));
          return db - da;
        });
        applyNoPosition(corners[0].x, corners[0].y);
      }

      function handlePointer(px, py){
        const r = noBtn.getBoundingClientRect();
        const d = distanceToRect(px, py, { left:r.left, top:r.top, right:r.right, bottom:r.bottom });
        if(d <= 110) moveNoAway(px, py);
      }

      function onPointerMove(e){
        if(ticking) return;
        ticking = true;
        requestAnimationFrame(() => { handlePointer(e.clientX, e.clientY); ticking = false; });
      }

      function onPointerDown(e){
        // If press is on/near NO, dodge immediately + block
        const r = noBtn.getBoundingClientRect();
        const d = distanceToRect(e.clientX, e.clientY, { left:r.left, top:r.top, right:r.right, bottom:r.bottom });
        if(d <= 130){
          e.preventDefault();
          e.stopPropagation();
          moveNoAway(e.clientX, e.clientY);
        }
      }

      function onTouchMove(e){
        if(!e.touches || !e.touches.length) return;
        const t = e.touches[0];
        if(ticking) return;
        ticking = true;
        requestAnimationFrame(() => { handlePointer(t.clientX, t.clientY); ticking = false; });
      }

      function onTouchStart(e){
        if(!e.touches || !e.touches.length) return;
        const t = e.touches[0];
        const r = noBtn.getBoundingClientRect();
        const d = distanceToRect(t.clientX, t.clientY, { left:r.left, top:r.top, right:r.right, bottom:r.bottom });
        if(d <= 130){
          e.preventDefault();
          e.stopPropagation();
          moveNoAway(t.clientX, t.clientY);
        }
      }

      // Safety net: any click on NO just triggersÈÄÉ„Åí„Çã
      noBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const r = noBtn.getBoundingClientRect();
        moveNoAway(r.left + r.width/2, r.top + r.height/2);
      }, true);

      // --- YES: random GIF + fly-in + mini-sound ---
      function pickRandomGif(){
        return GIFS[(Math.random() * GIFS.length) | 0];
      }

      function playPop(){
        // iOS requires user gesture; this is called inside click handler
        try{
          popSound.currentTime = 0;
          popSound.play().catch(()=>{});
        }catch(_){}
      }

      function showOverlay(){
        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden', 'false');

        // re-trigger animation
        overlayCard.classList.remove('fly-in');
        void overlayCard.offsetWidth;
        overlayCard.classList.add('fly-in');
      }

      function hideOverlay(){
        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden', 'true');
      }

      function burstHearts(originX, originY){
        const icons = ["‚ù§Ô∏è","üíñ","üíò","üíï","üíó","üíû"];
        const count = 18;
        for(let i=0;i<count;i++){
          const el = document.createElement('div');
          el.className = 'burst';
          el.textContent = icons[(Math.random()*icons.length)|0];
          const angle = Math.random() * Math.PI * 2;
          const dist = 60 + Math.random()*160;
          const dx = Math.cos(angle) * dist;
          const dy = Math.sin(angle) * dist - (20 + Math.random()*60);
          const rot = (Math.random()*140 - 70) + "deg";
          el.style.left = `${originX}px`;
          el.style.top  = `${originY}px`;
          el.style.setProperty('--dx', `${dx.toFixed(0)}px`);
          el.style.setProperty('--dy', `${dy.toFixed(0)}px`);
          el.style.setProperty('--rot', rot);
          burstLayer.appendChild(el);
          setTimeout(() => el.remove(), 950);
        }
      }

      yesBtn.addEventListener('click', () => {
        // update texts once
        question.textContent = "Yay! ‚ù§Ô∏è I knew it!";
        sub.textContent = "Okay, now come here. ü•π";

        // random GIF each time
        loveGif.src = pickRandomGif();

        // fun burst + overlay + sound
        const r = yesBtn.getBoundingClientRect();
        burstHearts(r.left + r.width/2, r.top + r.height/2);
        showOverlay();
        playPop();
      });

      closeBtn.addEventListener('click', hideOverlay);
      overlay.addEventListener('click', (e) => { if(e.target === overlay) hideOverlay(); });

      // Events for NO + iOS Safari quirks
      window.addEventListener('pointermove', onPointerMove, { passive:true });
      window.addEventListener('pointerdown', onPointerDown, { passive:false });
      window.addEventListener('touchmove', onTouchMove, { passive:true });
      window.addEventListener('touchstart', onTouchStart, { passive:false });

      // Re-layout on viewport changes (Safari toolbar hide/show)
      function relayout(){
        const prev = noBtn.style.transition;
        noBtn.style.transition = 'none';
        placeNoInitial();
        requestAnimationFrame(() => { noBtn.style.transition = prev || 'transform 240ms cubic-bezier(.12,.82,.2,1)'; });
      }

      spawnBgHearts();
      requestAnimationFrame(placeNoInitial);

      window.addEventListener('resize', () => { relayout(); spawnBgHearts(); });
      if(window.visualViewport){
        window.visualViewport.addEventListener('resize', relayout);
        window.visualViewport.addEventListener('scroll', relayout);
      }
    })();
  </script>
</body>
</html>
